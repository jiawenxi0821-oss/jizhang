<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>è´¦å•åˆ—è¡¨</title>
    <link rel="stylesheet" href="/css/bootstrap.css"></link>
    <script type="text/javascript" src="/js/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="/js/My97DatePicker/lang/zh-cn.js"></script>
    <script type="text/javascript" src="/js/jquery/jquery-1.10.2.min.js"></script>
    <style>
        .navbar-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 60px;
            margin-bottom: 20px;
        }
        .navbar-custom .navbar-brand {
            color: white;
            font-size: 22px;
            font-weight: bold;
            padding: 18px 15px;
        }
        .navbar-custom .navbar-brand:hover {
            color: #f0f0f0;
        }
        .navbar-custom .nav > li > a {
            color: white;
            font-size: 15px;
            padding: 20px 20px;
            transition: all 0.3s ease;
        }
        .navbar-custom .nav > li > a:hover,
        .navbar-custom .nav > li > a:focus {
            background-color: rgba(255,255,255,0.15);
            color: white;
        }
        .navbar-custom .nav > li.active > a {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }
        .user-info {
            color: rgba(255,255,255,0.9);
            padding: 20px 15px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-custom">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/">
                    ğŸ’° ä¸ªäººè®°è´¦ç³»ç»Ÿ
                </a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="/bill/list-page">ğŸ“Š æ”¶æ”¯è®°å½•</a></li>
                <li><a href="/billType/list">ğŸ·ï¸ åˆ†ç±»ç®¡ç†</a></li>
                <li><a href="/budget/list">ğŸ’° é¢„ç®—ç®¡ç†</a></li>
                <li><a href="/statistics/index">ğŸ“ˆ æ•°æ®ç»Ÿè®¡</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li th:if="${session.loginUser != null}">
                    <span class="user-info">
                        ğŸ‘¤ æ¬¢è¿ï¼Œ<span th:text="${session.loginUser.username}">ç”¨æˆ·</span>
                    </span>
                </li>
                <li th:if="${session.loginUser != null}">
                    <a href="/user/profile">âš™ï¸ ä¸ªäººä¿¡æ¯</a>
                </li>
                <li th:if="${session.loginUser != null}">
                    <a href="/user/logout">ğŸšª é€€å‡º</a>
                </li>
                <li th:if="${session.loginUser == null}">
                    <a href="/user/login">ğŸ”‘ ç™»å½•</a>
                </li>
            </ul>
        </div>
    </nav>

<div class="container">
<br/>
<h1>è´¦å•åˆ—è¡¨</h1>
<br/><br/>
<div class="with:80%">
    <form class="form-inline" id="qf"   action="/bill/list-page"  method="post">
		<!-- TODO åˆ†é¡µç›¸å…³å‚æ•°-->
        <input type="hidden" name="pageNum" id="pageNum" th:value="${pageInfo.pageNum}">
        <input type="hidden" name="pageSize" id="pageSize" th:value="${pageInfo.pageSize}">

        <div class="form-group">
            <label for="typeId" class="control-label">ç±»å‹</label>
            <select name="typeId" id="typeId" class="form-control">
                <option value="">å…¨éƒ¨</option>
                <option th:each="billType : ${billTypeList}"
                        th:value="${billType.id}" 
                        th:text="${billType.name}"
                        th:selected="${billType.id==bill.typeId}"
                ></option>
            </select>
        </div>
        <div class="form-group">
            <label for="date1" class="control-label" >å¼€å§‹æ—¶é—´</label>
            <input type="text" class="form-control"
                   autocomplete="off"
                   th:value="${bill.date1 != null ? #dates.format(bill.date1,'yyyy-MM-dd') : ''}"
                   name="date1" id="date1" placeholder="å¼€å§‹æ—¶é—´" onclick="WdatePicker()"/>
        </div>
        <div class="form-group">
            <label for="date2" class="control-label">ç»“æŸæ—¶é—´</label>
            <input type="text" class="form-control"
                   autocomplete="off"
                   th:value="${bill.date2 != null ? #dates.format(bill.date2,'yyyy-MM-dd') : ''}"
                   name="date2"  id="date2" placeholder="ç»“æŸæ—¶é—´" onclick="WdatePicker()"/>
        </div>
        <div class="form-group">
            <input type="button" id="searchBtn" value="æŸ¥è¯¢" class="btn btn-info" />
            &nbsp; &nbsp;
            <a href="/bill/list-page" class="btn btn-info">é‡ç½®</a>
            &nbsp; &nbsp;
            <a href="/bill/toAdd" th:href="@{/bill/toAdd}" class="btn btn-info">æ·»åŠ </a>
            &nbsp; &nbsp;
            <a href="/statistics/index" class="btn btn-success">æ•°æ®ç»Ÿè®¡</a>
            &nbsp; &nbsp;
            <a href="/billType/list" class="btn btn-warning">åˆ†ç±»ç®¡ç†</a>
            &nbsp; &nbsp;
            <a href="/budget/list" class="btn btn-info">é¢„ç®—ç®¡ç†</a>
        </div>
    </form>
</div>
<br/>

<div class="with:80%">
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th>
                <input type="checkbox"  id="checkAll"/>
                <button type="button" class="btn btn-danger" id="btnBatch">åˆ  é™¤</button><!---å°æŒ‰é’®--->
            </th>
            <th>#</th>
            <th>æ ‡é¢˜</th>
            <th>æ—¶é—´</th>
            <th>é‡‘é¢</th>
            <th>ç±»åˆ«</th>
            <th>è¯´æ˜</th>
            <th>æ“ä½œ</th>
        </tr>
        </thead>
        <tbody>
		<!-- TODO é¡µé¢å¾ªç¯-->
        <form action="/bill/batchDel" method="post" id="df">
        <tr th:each="bill:${pageInfo.list}">

            <td >
                <input type="checkbox" name="ids" th:value="${bill.id}"/>

            </td>
            <td th:text="${bill.id}"></td>
            <td th:text="${bill.title}">æ ‡é¢˜</td>
            <td th:text="${#dates.format(bill.billTime,'yyyy-MM-dd')}">æ—¶é—´</td>
            <td th:text="${bill.price}">é‡‘é¢</td>
            <td th:text="${bill.name}">ç±»åˆ«</td>
            <td th:text="${bill.explains}">è¯´æ˜</td>
            <td>
                <!---<a th:href="'/bill/delete/'+${bill.id}" onclick="return confirm('ä½ ç¡®å®šåˆ é™¤å—ï¼Ÿ')">
                    <button type="button" class="btn btn-danger" >åˆ  é™¤1</button>
                </a>--->
                <a th:href="|/bill/toUpdate/${bill.id}|">
                <button type="button" class="btn btn-info" >ç¼– è¾‘</button>
                </a>
                <a th:href="@{/bill/delete2(id=${bill.id})}" onclick="return confirm('ä½ ç¡®å®šåˆ é™¤å—ï¼Ÿ')">
                    <button type="button" class="btn btn-danger">åˆ  é™¤</button>
                </a>

            </td>
        </tr>
        </form>
        </tbody>
    </table>
</div>

<!-- TODO åˆ†é¡µå·¥å…·ç±»-->
<ul class="pagination">
    <li><button class="btn btn-default" id="first">ç¬¬ä¸€é¡µ</button></li>
    <li><button class="btn btn-default" id="prev">ä¸Šä¸€é¡µ</button></li>
     <li th:each="p: ${pageInfo.navigatepageNums}">
          <button class="btn btn-default" th:text="${p}" name="pn" th:disabled="${p == pageInfo.pageNum}" >#</button>
      </li>
    <li><button class="btn btn-default" id="next" >ä¸‹ä¸€é¡µ</button></li>
    <li><button class="btn btn-default" id="last">æœ€åé¡µ</button></li>

    <span style="font-size: 18px;margin-left: 5px;" th:text="|å…±${pageInfo.total}æ¡è®°å½•,å…±${pageInfo.pages}é¡µ, æ¯é¡µ ${pageInfo.pageSize} è¡Œæ•°|">å…±æ¡  è®°å½•,å…±  é¡µ, æ¯é¡µ  è¡Œæ•°</span>
    <select id="setRows" >
        <option value="5"   th:selected="${pageInfo.pageSize == 5}" >5</option>
        <option value="10"  th:selected="${pageInfo.pageSize == 10}">10</option>
        <option value="20"  th:selected="${pageInfo.pageSize == 20}">20</option>
        <option value="30"  th:selected="${pageInfo.pageSize == 30}">30</option>
    </select>

</ul>

<!-- TODO åˆ†é¡µçš„jsä»£ç -->
<script type="text/javascript">
    var pageNum = [[${pageInfo.pageNum}]]//å½“å‰é¡µ
    var pages = [[${pageInfo.pages}]]
    var  hasPreviousPage = [[${pageInfo.hasPreviousPage}]]//æœ‰æ²¡æœ‰ä¸Šä¸€é¡µ
    var  hasNextPage = [[${pageInfo.hasNextPage}]]//æœ‰æ²¡æœ‰ä¸‹ä¸€é¡µ
    //ç¬¬ä¸€é¡µ
    $(function(){
        $("#checkAll").click(function (){
           var flag =  $(this).prop("checked")
           $('[name="ids"]').prop("checked",flag)
        });

        $('[name="ids"]').click(function (){
            var checkLen =$('[name="ids"]').length;//ä¸€å…±æœ‰å¤šå°‘ä¸ªå¤é€‰æ¡†
            var cedLen =$('[name="ids"]:checked').length;//æœ‰å‡ ä¸ªå¤é€‰æ¡†æ‰“å‹¾äº†
            var flag = checkLen == cedLen;
            $("#checkAll").prop("checked",flag);
        })


        $("#btnBatch").click(function(){
            if($('[name="ids"]:checked').length==0)
            {
                alert("è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡æ•°æ®!");
                return ;
            }else {
                $("#df").submit();
            }

        })

        $("#first").click(function (){
            $("#pageNum").val(1)
            $("#qf").submit();
        });
    });
    //ä¸Šä¸€é¡µ
        $("#prev").click(function (){
            $("#pageNum").val(pageNum-1)
            $("#qf").submit();
        });
    //ä¸‹ä¸€é¡µ
        $("#next").click(function (){
            $("#pageNum").val(pageNum+1)
            $("#qf").submit();
        });
    //æœ€åä¸€é¡µ
    $(function(){
        $("#last").click(function (){
            $("#pageNum").val(pages)
            $("#qf").submit();
        });
    $("button[name='pn']").click(function (){
        $("#pageNum").val($(this).html())
        $("#qf").submit();
    })
    //è¾¹ç•Œåˆ¤æ–­
    if(!hasPreviousPage)
    {
        $("#first").prop("disabled",true)
        $("#prev").prop("disabled",true)
    }
    if(!hasNextPage)
    {
        $("#last").prop("disabled",true)
        $("#next").prop("disabled",true)
    }

    $("#setRows").change(function (){
        var pageSize = $(this).val()
        $("#pageSize").val(pageSize)
        $("#qf").submit();
    })
     $("#searchBtn").click(function (){
         $("#pageNum").val(1);
         $("#qf").submit();
     })
    });
</script>

</div>
</body>
</html>